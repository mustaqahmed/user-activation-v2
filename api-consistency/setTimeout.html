<!DOCTYPE html>
<html>
<head>
  <title>User Activation v2 with setTimeout</title>
  <link rel="stylesheet" href="styles.css">
  <script src="common.js"></script>
  <script src="api-tester.js"></script>
  <script>
    function callWithSetTimeoutChain(depth) {
      if (depth <= 0)
        apiTester.callApi(apiTester.getSelectedApi());
      else
        setTimeout(() => callWithSetTimeoutChain(depth-1), 100);
    }

    function init() {
      apiTester.setupApiSelector();
      apiTester.setupApiCaller();

      for (let i = 0; i < 3; i++) {
        $("button" + i).addEventListener("click", e => {
          log(e.target.id + " clicked", "yellow");
          callWithSetTimeoutChain(i+1);
        });
      }
    }
  </script>
</head>
<body onload="init()">
  <div class="instruction">
    <p><b>Steps:</b>&ensp;
      (a) Select an API to test.&ensp;
      (b) Click the button for the desired setTimeout call depth.</p>
    <p><b>Expectation:</b> Any these buttons should successsfully call the test API.
      User Activation v2 works in each case.</p>
  </div>

  <p>
    <label>User-activation-gated API to test:</label>
    <select id="test-api">
    </select>
  </p>

  <div class="api_target" id="test-api-target"></div>

  <p>
    <input id="button0" type="button" value="Button 0" />
    tests through a setTimeout() call.
  </p>

  <p>
    <input id="button1" type="button" value="Button 1" />
    tests through setTimeout() calls of depth 2.
  </p>

  <p>
    <input id="button2" type="button" value="Button 2" />
    tests through setTimeout() calls of depth 3.
  </p>

  <div id="log"><b>Log:</b> </div>
</body>
</html>
