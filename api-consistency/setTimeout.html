<!DOCTYPE html>
<html>
<head>
  <title>User Activation v2 with setTimeout</title>
  <link rel="stylesheet" href="styles.css">
</head>
<script>
function $(id) {
  return document.getElementById(id);
}

function log(msg, color) {
  var styleStr = "background-color:" + color;

  $("log").innerHTML += "<span class='log-entry' style='" + styleStr + "'>"
    + msg + "</span>";
}

function callWindowOpen() {
  if (window.open("about:blank"))
    log("popup success", "lightgreen");
  else
    log("popup failure", "lightpink");
}

function popupAfter100ms() {
  setTimeout(callWindowOpen, 100);
}

function asyncPopupAfter100ms() {
  setTimeout(popupAfter100ms, 0);
}

function buttonClickHandler(e) {
  log(e.target.id + " clicked", "yellow");
  if (e.target.id == "button1")
    popupAfter100ms();
  else if (e.target.id == "button2")
    asyncPopupAfter100ms();
  else
    log("error", "red");
}

function init() {
  $("button1").addEventListener("click", buttonClickHandler);
  $("button2").addEventListener("click", buttonClickHandler);
}
</script>
<body onload="init()">
  <div class="instruction">
    <b>With User Activation v2, clicking on either of these buttons opens a popup window.</b>
  </div>

  <p>
    <input id="button1" type="button" value="Button 1" />
    opens a popup after a 100ms delay.
  </p>

  <p>
    <input id="button2" type="button" value="Button 2" />
    opens a popup asynchronously after a 100ms delay.
  </p>

  <div id="log"><b>Log:</b> </div>
</body>
</html>
